- name: Install nvm
  shell: >
    curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.37.2/install.sh | bash
  args:
    creates: "{{ ansible_env.HOME }}/.nvm/nvm.sh"
    executable: /bin/bash
    chdir: "{{ ansible_env.HOME }}"

- name: Install Node
  shell: /bin/bash -ic nvm install --lts --latest-npm
  register: node_version_response
  changed_when: "'already installed' not in node_version_response.stderr"

- name: Install NPM packages
  npm:
    name: aws-cdk
    global: yes